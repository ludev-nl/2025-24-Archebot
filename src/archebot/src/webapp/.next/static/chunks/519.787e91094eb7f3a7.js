(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[519],{2519:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var n=r(8089),o=r(3739),l=r(13);r(9218),r(5918),r(4472);let a=e=>{let{onBoxChange:t,path:r,shards:a}=e,[s,c]=(0,l.useState)();(0,l.useEffect)(()=>{fetch("".concat("http://145.118.192.32:5000","/locationlog")).then(e=>e.json()).then(e=>{c(e?o.latLng(e.latitude,e.longitude):void 0)}).catch(e=>{console.error(e)})},[]),console.log("latest log after loading:",s);let[u,i]=(0,l.useState)({southWest:null,northEast:null,southEast:null,northWest:null}),g=(0,l.useRef)(u);(0,l.useEffect)(()=>{g.current=u},[u]);let d=(0,l.useRef)(null),p=(0,l.useRef)(null),h=(0,l.useRef)(null),m=(0,l.useRef)(null);(0,l.useEffect)(()=>{if(p.current&&!d.current&&(console.log("Latest log in map componets:",s),s))return d.current=o.map(p.current).setView(s,16),o.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(d.current),d.current.pm.addControls({position:"topleft",drawMarker:!1,drawCircleMarker:!1,drawPolyline:!1,drawRectangle:!0,drawPolygon:!1,drawCircle:!1,editMode:!0,dragMode:!0,rotateMode:!0,cutPolygon:!1,removalMode:!0}),d.current.on("pm:create",e=>{if("Rectangle"===e.shape){if(h.current){var r;null===(r=d.current)||void 0===r||r.removeLayer(h.current)}let n=e.layer;h.current=n,f(n),h.current.bringToFront(),n.on("pm:rotateend",e=>{let t=n.pm.getAngle(),r=n.pm.getRotationCenter();v(n,r,t)}),n.on("pm:edit pm:dragend",()=>{console.log("Edit or drag ended"),f(n)}),n.on("pm:rotate",()=>{var e,t;let r=n.pm.getRotationCenter(),o=n.pm.getAngle();null===(e=m.current)||void 0===e||e.pm.setRotationCenter(r),null===(t=m.current)||void 0===t||t.pm.rotateLayerToAngle(o)}),n.on("pm:remove",()=>{h.current=null;let e={southWest:null,northEast:null,southEast:null,northWest:null};if(i(e),t(e),m.current){var r;null===(r=d.current)||void 0===r||r.removeLayer(m.current),m.current=null}})}}),()=>{d.current&&(d.current.remove(),d.current=null)}},[s,t]),(0,l.useEffect)(()=>{if(d.current&&(m.current&&(d.current.removeLayer(m.current),m.current=null),r&&0!==r.length))try{var e;let t=o.polyline(r,{color:"red",weight:4,opacity:.7}).addTo(d.current);t.pm.disable(),t.pm.disableRotate(),m.current=t,m.current.pm.setOptions({draggable:!1,allowRotation:!1,allowEditing:!1}),null===(e=m.current)||void 0===e||e.bringToBack()}catch(e){console.error("Error creating polyline:",e)}},[r]);let f=e=>{let r=e.getLatLngs();console.log("Corners:",r);let n={northWest:r[0][0],southWest:r[0][1],southEast:r[0][2],northEast:r[0][3]};i(n),t(n)};(0,l.useEffect)(()=>{if(console.log("shards state:",a),!d.current||!a)return;let e=d.current;console.log("Shards:",a),a.forEach(t=>{let r=o.latLng(t.lat,t.lng),n=!1;if(e.eachLayer(e=>{if(e instanceof o.Marker&&e.getLatLng().equals(r)){n=!0;return}}),n||!t)return;let l=o.marker(o.latLng(t.lat,t.lng),{icon:o.icon({iconUrl:"/marker.png",iconSize:[32,32],iconAnchor:[16,16]})});t.image&&l.bindPopup('<img src="'.concat("http://145.118.192.32:5000/static/"+t.image,'" alt="shard" style="width: 150px;" />')),d.current&&l.addTo(d.current)})},[a]);let v=(e,r,n)=>{let o=e.pm.getRotationCenter(),l=e.pm.getAngle();e.pm.setRotationCenter(o),e.pm.rotateLayerToAngle(l),console.log("rotated shape:",e.getLatLngs());let a=e.getLatLngs(),s={northWest:a[0][0],southWest:a[0][1],southEast:a[0][2],northEast:a[0][3]};i(s),t(s)};return(0,n.jsxs)("div",{style:{height:"100vh",width:"100%",position:"relative"},children:[(0,n.jsx)("div",{ref:p,style:{height:"100%",width:"100%"}}),(0,n.jsx)("div",{className:"corner-coordinates",children:(0,n.jsx)("p",{children:"Draw a rectangle on the map"})})]})}},4472:()=>{},9218:()=>{}}]);